{% extends "base.html" %}  
{% load static %}

{% block style %}
{% endblock %}

{% block h1 %}
Write linked article for {{umowa.domena}}
{% endblock %}

{% block content %}

{% if user.is_staff %}
<h2 id="h2-extender" style="text-align: center;">Po prostu odśwież to zaplecze!</h2>
<div class="semstorm-refresh-container">
    <h2 class="pulse"><strong>Ostrożnie!</strong></h2>
    <div style="display: flex; flex-direction: column; align-items: center;" class="form-group">
        <label class="form-label" for="semstorm_api_key">Semstorm API key:</label>
        <input style="max-width: 25%;" type="text" class="form-control" id="semstorm_api_key" name="semstorm_api_key" value="{{user.account.semstorm_api_key}}">
    </div>
    <div class="ref-button-holder"><button type="refresh_visibility" id="refresh_visibility" class="refresh_visibility">Refresh Semstorm</button></div>
</div>
{% endif %}

{% if papaj_spi.is_staff %}
<div class="container mt-5">
    <div style="position: fixed; top: 85%; right: 0; transform: translateY(-50%); width: 250px; height: auto; background-color: #3498db; color: #ffffff; z-index: 1000; padding: 20px; text-align: center; box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.2);">
        <p style="margin-bottom: 10px; font-size: 1.2em;">Ilość wybranych zaplecz: <span id="zapleczaCount" style="font-weight: bold;">0</span></p>
        <p style="font-size: 1.2em;">Ilość linków: <span id="linksCount" style="font-weight: bold;">0</span></p>
    </div>
    
    <div class="row">
        <div class="col-md-12">
            <div class="card shadow">
                <div class="card-body">
                    <h3>Dostępne zaplecza</h3>
                    <p>Click to select any zaplecze</p>
                </div>
                <div class="additional-attributes" style="display: block;padding-top: 0;">
                    <table id="zaplacza-table" data-order='[[ 1, "asc" ]]' style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Linkować</th>
                                <th>Tematyka</th>
                                <th>Adres</th>
                                <th>Visibility from</th>
                                <th>top3</th>
                                <th>top10</th>
                                <th>top50</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for z in zaplecza.values %}
                            <tr>
                                <td><input type="checkbox" data-user="{{z.login}}" data-key="{{z.wp_api_key}}"></td>
                                <td>{{z.topic}}</td>
                                <td>{{z.domain}}</td>
                                <td>{{z.date}}</td>
                                <td style="color: black; background-color: {% if z.top3_growth == 1 %}#cfecd0{% elif z.top3_growth == 0 %}#dfdacf{% else %}#ffc5ca{% endif %}">{{z.top3}}</td>
                                <td style="color: black; background-color: {% if z.top10_growth == 1 %}#cfecd0{% elif z.top10_growth == 0 %}#dfdacf{% else %}#ffc5ca{% endif %}">{{z.top10}}</td>
                                <td style="color: black; background-color: {% if z.top50_growth == 1 %}#cfecd0{% elif z.top50_growth == 0 %}#dfdacf{% else %}#ffc5ca{% endif %}">{{z.top50}}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h3>Zaplecza na mase</h3>
                    <p>Click to select several zapleczas from category</p>
                </div>
                <div class="additional-attributes">
                    <p>Ilość wybranych zaplecz: <span id="zapleczaCount">0</span></p>
                    <label class="form-label" for="topic">Tematyka zaplecz:</label>
                    <select class="form-control" id="topics" name="topics">
                        {% for z in zaplecza_unique %}
                        <option value="{{z}}">{{z}}</option>
                        {% endfor %}
                    </select>
                    <h6>Number of zapleczas</h6>
                    <div class="slider-container">
                        <input type="range" id="zapleczaSlider" class="range-slider" min="0" max="10" value="0" name="zaplecza_count">
                        <input type="text" id="zapleczaSliderValue" class="range-value" value="0" readonly>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h3 class="card-title">Links</h3>
                    <p>Click to write texts with custom links</p>
                </div>
                <div class="additional-attributes">
                    <button type="button" id="addlinks">Add links</button>
                </div>
            </div>
        </div>
    </div>
    
    
    <div class="row">
        <div class="col-md-12">
            <div class="card shadow">
                <div class="card-body">
                    <h3>Frazy z panelu</h3>
                    <p>Click to select keywords to write texts about</p>
                </div>
                <div class="additional-attributes">
                    <table id="frazy-table">
                        <tr>
                            <th>URL</th>
                            <th>Fraza</th>
                            <th>Linki</th>
                        </tr>
                        {% for r in umowa.podstrony %}
                            {% if forloop.counter0|divisibleby:2  %}
                            <tr>
                                <td>{{r}}</td>
                            {% else %}
                                <td>{{r}}</td>
                                <td><input type="number" min="0" max="5" value="0"></td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                    </table>
                </div>
            </div>
        </div>
    </div>



<div class="row">
    

    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-body">
                <h3 class="card-title">Details</h3>
                <p>Click to add publication details</p>
            </div>
            <div class="additional-attributes" id="write-details">
                <form id="writeLinks" type="post">
                    {% csrf_token %}
                    {% if not data.topic %}
                    <div class="form-group">
                        <label class="form-label" for="topic">Articles topic:</label>
                        <input type="text" class="form-control" id="topic" name="topic">
                    </div>
                    {% endif %}
                    <input type="hidden" name="lang" value="{{umowa.lang}}">
                    <div class="form-group">
                        <label class="form-label" for="openai_api_key">OpenAI API key:</label>
                        <input type="text" class="form-control" id="openai_api_key" name="openai_api_key" value="{{user.account.openai_api_key}}">
                    </div>
                    {% comment %} <h6>Articles</h6>
                    <div class="slider-container">
                        <input type="range" id="ArtSlider" class="range-slider" min="1" max="5" value="1" name="a_num">
                        <input type="text" id="ArtSliderValue" class="range-value" value="1" readonly>
                    </div> {% endcomment %}
                    <h6>Paragraphs per article</h6>
                    <div class="slider-container">
                        <input type="range" id="ParagraphsSlider" class="range-slider" min="2" max="8" value="4" name="p_num">
                        <input type="text" id="ParagraphsSliderValue" class="range-value" value="4" readonly>
                    </div>
                    <div class="date-container">
                        <label>Start date</label>
                        <input type="date" value="2005-04-02" id="start_date" name="start_date" style="margin-left: 12px;"/>
                    </div>
                    <h6>Days between articles</h6>
                    <div class="slider-container">
                        <input type="range" id="DaysSlider" class="range-slider" min="2" max="14" value="7" name="days_delta">
                        <input type="text" id="DaysSliderValue" class="range-value" value="7" readonly>
                    </div>
                    <div class="checkbox-container">
                        <label>Publish forward</label>
                        <input type="checkbox" id="forward_delta" class="checkbox" name="forward_delta">
                    </div>
                    <button type="submit">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>

{% else %}

    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;"><h2>Dzisiaj zamknięte</h2>
<div style="display: flex;"><h3 style="margin:0px 10px">Reason:</h3><h3 style="margin:0px 10px; font-weight: bold;">{{papaj_spi.first_name}}</h3></div>
</div>

    {% endif %}

    {% endblock %}

{% block script %}
<script src="{% static 'js/refresh_vis_base.js' %}"></script>
<script src="{% static 'js/links.js' %}"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
<script>
    $(document).ready(function() {
        let table = new DataTable('#zaplacza-table', {
            paging: false,
            scrollY: "40vh",
            scrollCollapse: true
        });
        $('#zaplacza-table').DataTable().columns.adjust();
        $('#zaplacza-table').parent().parent().parent().parent().hide();
    });
</script>
{% endblock %}